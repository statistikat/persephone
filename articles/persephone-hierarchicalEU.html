<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hierarchical time series - construction and weights • persephone</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Hierarchical time series - construction and weights">
<meta property="og:description" content="persephone">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">persephone</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/persephone-hierarchical.html">Hierarchical time series</a>
    </li>
    <li>
      <a href="../articles/persephone-hierarchicalEU.html">Hierarchical time series - construction and weights</a>
    </li>
    <li>
      <a href="../articles/persephone-ntts2021.pdf">persephone ntts2021 (PDF)</a>
    </li>
    <li>
      <a href="../articles/persephone-plotting.html">Plotting with persephone</a>
    </li>
    <li>
      <a href="../articles/persephone-useR.pdf">persephone useR!2019 (PDF)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/statistikat/persephone/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="persephone-hierarchicalEU_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Hierarchical time series - construction and weights</h1>
                        <h4 data-toc-skip class="author">Alexander Kowarik, Gregor de Cillia</h4>
            
            <h4 data-toc-skip class="date">2022-03-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/statistikat/persephone/blob/HEAD/vignettes/persephone-hierarchicalEU.Rmd" class="external-link"><code>vignettes/persephone-hierarchicalEU.Rmd</code></a></small>
      <div class="hidden name"><code>persephone-hierarchicalEU.Rmd</code></div>

    </div>

    
    
<p>Hierarchical time series are time series that can be divided into sub-series. In <code>persephone</code>, such objects are created similar to a nested list. The following example creates a series with European aggregate based on another aggregate of south and north European countries or their IPI respectively.</p>
<p>First we load the data from the <code>RJDemetra</code> and remove the EU aggregate.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statistikat/persephone" class="external-link">persephone</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ipi_c_eu</span>, package <span class="op">=</span> <span class="st">"RJDemetra"</span><span class="op">)</span>
<span class="va">ipi_eu</span> <span class="op">&lt;-</span> <span class="va">ipi_c_eu</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span><span class="op">:</span><span class="fl">34</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>For all countries’ time series we now want to generate a persephone object with Tramo as method.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts_28</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ipi_eu</span>, <span class="va">perTramo</span><span class="op">)</span></code></pre></div>
<p>We generate a additional layer based on a certain regional grouping of the countries</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">south_eastern_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BG"</span>,<span class="st">"EL"</span>,<span class="st">"CY"</span>,<span class="st">"RO"</span><span class="op">)</span>
<span class="va">northern_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DK"</span>,<span class="st">"FI"</span>,<span class="st">"SE"</span><span class="op">)</span>
<span class="va">central_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HR"</span>,<span class="st">"DE"</span>,<span class="st">"CZ"</span>,<span class="st">"SK"</span>,<span class="st">"HU"</span>,<span class="st">"AT"</span>,<span class="st">"SI"</span>,<span class="st">"LU"</span>,<span class="st">"EE"</span>,<span class="st">"LT"</span>,<span class="st">"LV"</span>,<span class="st">"PL"</span><span class="op">)</span>
<span class="va">southern_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IT"</span>,<span class="st">"ES"</span>,<span class="st">"PT"</span>,<span class="st">"MT"</span><span class="op">)</span>
<span class="va">western_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FR"</span>,<span class="st">"BE"</span>,<span class="st">"NL"</span>,<span class="st">"UK"</span><span class="op">)</span> <span class="co"># without IE (missing from the dataset)</span></code></pre></div>
<p>The list argument can be used to create a hierachical persephone object based on a list of persephone objects.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hts_see</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">south_eastern_europe</span><span class="op">]</span><span class="op">)</span>
<span class="va">hts_ne</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">northern_europe</span><span class="op">]</span><span class="op">)</span>
<span class="va">hts_ce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">central_europe</span><span class="op">]</span><span class="op">)</span>
<span class="va">hts_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">southern_europe</span><span class="op">]</span><span class="op">)</span>
<span class="va">hts_we</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">western_europe</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>An additional layer is only the nothern part and southern part</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hts_np</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>norhtern_europe <span class="op">=</span> <span class="va">hts_ne</span>,
                 western_europe <span class="op">=</span> <span class="va">hts_we</span>,
                 central_europe <span class="op">=</span> <span class="va">hts_ce</span>
<span class="op">)</span>
<span class="va">hts_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>southern_europe <span class="op">=</span> <span class="va">hts_se</span>,
                 south_eastern_europe <span class="op">=</span> <span class="va">hts_see</span>
<span class="op">)</span></code></pre></div>
<p>Finally we aggregate them to the whole of EU.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ht_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>north_part <span class="op">=</span> <span class="va">hts_np</span>,
                 south_part <span class="op">=</span> <span class="va">hts_sp</span>
<span class="op">)</span>
<span class="va">ht_europe</span>
<span class="co">#&gt;  component                          run   class                 </span>
<span class="co">#&gt;                                     FALSE hierarchicalTimeSeries</span>
<span class="co">#&gt;  north_part                         FALSE hierarchicalTimeSeries</span>
<span class="co">#&gt;  north_part/norhtern_europe         FALSE hierarchicalTimeSeries</span>
<span class="co">#&gt;  north_part/norhtern_europe/DK      FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/norhtern_europe/FI      FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/norhtern_europe/SE      FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/western_europe          FALSE hierarchicalTimeSeries</span>
<span class="co">#&gt;  north_part/western_europe/FR       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/western_europe/BE       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/western_europe/NL       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/western_europe/UK       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe          FALSE hierarchicalTimeSeries</span>
<span class="co">#&gt;  north_part/central_europe/HR       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/DE       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/CZ       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/SK       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/HU       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/AT       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/SI       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/LU       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/EE       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/LT       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/LV       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  north_part/central_europe/PL       FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  south_part                         FALSE hierarchicalTimeSeries</span>
<span class="co">#&gt;  south_part/southern_europe         FALSE hierarchicalTimeSeries</span>
<span class="co">#&gt;  south_part/southern_europe/IT      FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  south_part/southern_europe/ES      FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  south_part/southern_europe/PT      FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  south_part/southern_europe/MT      FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  south_part/south_eastern_europe    FALSE hierarchicalTimeSeries</span>
<span class="co">#&gt;  south_part/south_eastern_europe/BG FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  south_part/south_eastern_europe/EL FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  south_part/south_eastern_europe/CY FALSE tramoseatsSingle      </span>
<span class="co">#&gt;  south_part/south_eastern_europe/RO FALSE tramoseatsSingle</span></code></pre></div>
<p>Now we make the first run:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ht_europe</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span>
<span class="va">ht_europe</span>
<span class="co">#&gt;  component                          run  class                  seasonality</span>
<span class="co">#&gt;                                     TRUE hierarchicalTimeSeries Present    </span>
<span class="co">#&gt;  north_part                         TRUE hierarchicalTimeSeries Present    </span>
<span class="co">#&gt;  north_part/norhtern_europe         TRUE hierarchicalTimeSeries Present    </span>
<span class="co">#&gt;  north_part/norhtern_europe/DK      TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/norhtern_europe/FI      TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/norhtern_europe/SE      TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/western_europe          TRUE hierarchicalTimeSeries Present    </span>
<span class="co">#&gt;  north_part/western_europe/FR       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/western_europe/BE       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/western_europe/NL       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/western_europe/UK       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe          TRUE hierarchicalTimeSeries Present    </span>
<span class="co">#&gt;  north_part/central_europe/HR       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/DE       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/CZ       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/SK       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/HU       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/AT       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/SI       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/LU       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/EE       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/LT       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/LV       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  north_part/central_europe/PL       TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  south_part                         TRUE hierarchicalTimeSeries Present    </span>
<span class="co">#&gt;  south_part/southern_europe         TRUE hierarchicalTimeSeries Present    </span>
<span class="co">#&gt;  south_part/southern_europe/IT      TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  south_part/southern_europe/ES      TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  south_part/southern_europe/PT      TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  south_part/southern_europe/MT      TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  south_part/south_eastern_europe    TRUE hierarchicalTimeSeries Present    </span>
<span class="co">#&gt;  south_part/south_eastern_europe/BG TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  south_part/south_eastern_europe/EL TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  south_part/south_eastern_europe/CY TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  south_part/south_eastern_europe/RO TRUE tramoseatsSingle       Present    </span>
<span class="co">#&gt;  logTransform arimaMdl       nOutliers qStat</span>
<span class="co">#&gt;   TRUE        (2 1 1)(0 1 1) 6         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 8         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 2         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 2         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 1         NA   </span>
<span class="co">#&gt;   TRUE        (2 1 0)(1 1 1) 2         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 6         NA   </span>
<span class="co">#&gt;  FALSE        (2 1 0)(0 1 1) 4         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 3         NA   </span>
<span class="co">#&gt;   TRUE        (2 1 0)(1 1 1) 2         NA   </span>
<span class="co">#&gt;  FALSE        (3 0 0)(0 1 1) 4         NA   </span>
<span class="co">#&gt;   TRUE        (2 1 0)(0 1 1) 5         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 5         NA   </span>
<span class="co">#&gt;   TRUE        (2 1 0)(0 1 1) 2         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 4         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 7         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 2         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 5         NA   </span>
<span class="co">#&gt;   TRUE        (3 1 1)(0 1 1) 4         NA   </span>
<span class="co">#&gt;  FALSE        (0 1 1)(0 1 1) 4         NA   </span>
<span class="co">#&gt;   TRUE        (3 1 1)(0 1 1) 1         NA   </span>
<span class="co">#&gt;  FALSE        (0 1 1)(0 1 1) 1         NA   </span>
<span class="co">#&gt;   TRUE        (3 1 1)(0 1 1) 1         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 3         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 3         NA   </span>
<span class="co">#&gt;   TRUE        (2 1 0)(0 1 1) 3         NA   </span>
<span class="co">#&gt;  FALSE        (2 1 0)(0 1 1) 7         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 4         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 5         NA   </span>
<span class="co">#&gt;   TRUE        (2 1 0)(0 1 1) 0         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 4         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 6         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 1         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 2         NA   </span>
<span class="co">#&gt;   TRUE        (0 1 1)(0 1 1) 4         NA</span></code></pre></div>
<div class="section level2">
<h2 id="weights">Weights<a class="anchor" aria-label="anchor" href="#weights"></a>
</h2>
<p>Weights can be used to customize the aggregation step, so the hierachical time series is not just the sum of its components, but the weighted sum. This can be especially helpful if the timeseries are indices.</p>
<div class="section level3">
<h3 id="time-invariant-weights">Time-invariant weights<a class="anchor" aria-label="anchor" href="#time-invariant-weights"></a>
</h3>
<p>The weights parameter will be set as numeric vector with length equal to the number of components.</p>
<p>Almost the same call, but with weights, one for each component and one for all time points.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hts_see</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">south_eastern_europe</span><span class="op">]</span>, weights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">hts_ne</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">northern_europe</span><span class="op">]</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span><span class="op">)</span>
<span class="va">hts_ce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">central_europe</span><span class="op">]</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span>
<span class="va">hts_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">southern_europe</span><span class="op">]</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">10.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">hts_we</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">western_europe</span><span class="op">]</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">13</span>,<span class="fl">14</span><span class="op">)</span><span class="op">)</span> <span class="co"># without IE</span></code></pre></div>
<p>In additional aggregation steps, the weight is automatically summed up. So e.g. the weight for central europe is 12, the sum of 12 times 1.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hts_np</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>northern_europe <span class="op">=</span> <span class="va">hts_ne</span>,
                 western_europe <span class="op">=</span> <span class="va">hts_we</span>,
                 central_europe <span class="op">=</span> <span class="va">hts_ce</span>
<span class="op">)</span>
<span class="va">hts_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>southern_europe <span class="op">=</span> <span class="va">hts_se</span>,
                 south_eastern_europe <span class="op">=</span> <span class="va">hts_see</span>
<span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hts_np</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">northern_europe</th>
<th align="right">western_europe</th>
<th align="right">central_europe</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">18</td>
<td align="right">50</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">50</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="right">18</td>
<td align="right">50</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">50</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="right">18</td>
<td align="right">50</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">50</td>
<td align="right">12</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ht_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>north_part <span class="op">=</span> <span class="va">hts_np</span>,
                 south_part <span class="op">=</span> <span class="va">hts_sp</span>
<span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ht_europe</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">north_part</th>
<th align="right">south_part</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">80</td>
<td align="right">47.5</td>
</tr>
<tr class="even">
<td align="right">80</td>
<td align="right">47.5</td>
</tr>
<tr class="odd">
<td align="right">80</td>
<td align="right">47.5</td>
</tr>
<tr class="even">
<td align="right">80</td>
<td align="right">47.5</td>
</tr>
<tr class="odd">
<td align="right">80</td>
<td align="right">47.5</td>
</tr>
<tr class="even">
<td align="right">80</td>
<td align="right">47.5</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="time-variant-weights">Time-variant weights<a class="anchor" aria-label="anchor" href="#time-variant-weights"></a>
</h3>
<p>In many scenarios weights are not fixed over time, but change, e.g. if the turnover is used to aggregate a certain production index. In these scenarios weights can be provided as lists of time series or as a mts object.</p>
<p>We are starting with weights equal to 1 and then only change the weight of Austria over time.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weights_eu</span> <span class="op">&lt;-</span> <span class="va">ipi_eu</span> <span class="op">*</span> <span class="fl">0</span> <span class="op">+</span> <span class="fl">1</span>
<span class="va">weights_eu</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">weights_eu</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">weights_eu</span><span class="op">[</span>,<span class="st">"AT"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">weights_eu</span><span class="op">[</span>,<span class="st">"AT"</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">weights_eu</span><span class="op">[</span>,<span class="st">"AT"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>We can now call the <code>perHts</code> function with the mts as input.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hts_see</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">south_eastern_europe</span><span class="op">]</span>,
                   weights<span class="op">=</span><span class="va">weights_eu</span><span class="op">[</span>,<span class="va">south_eastern_europe</span><span class="op">]</span><span class="op">)</span>
<span class="va">hts_ne</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">northern_europe</span><span class="op">]</span>,
                  weights<span class="op">=</span><span class="va">weights_eu</span><span class="op">[</span>,<span class="va">northern_europe</span><span class="op">]</span><span class="op">)</span>
<span class="va">hts_ce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">central_europe</span><span class="op">]</span>,
                  weights<span class="op">=</span><span class="va">weights_eu</span><span class="op">[</span>,<span class="va">central_europe</span><span class="op">]</span><span class="op">)</span>
<span class="va">hts_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">southern_europe</span><span class="op">]</span>,
                  weights<span class="op">=</span><span class="va">weights_eu</span><span class="op">[</span>,<span class="va">southern_europe</span><span class="op">]</span><span class="op">)</span>
<span class="va">hts_we</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>list <span class="op">=</span> <span class="va">ts_28</span><span class="op">[</span><span class="va">western_europe</span><span class="op">]</span>,
                  weights<span class="op">=</span><span class="va">weights_eu</span><span class="op">[</span>,<span class="va">western_europe</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>And then we can proceed as before.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hts_np</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>northern_europe <span class="op">=</span> <span class="va">hts_ne</span>,
                 western_europe <span class="op">=</span> <span class="va">hts_we</span>,
                 central_europe <span class="op">=</span> <span class="va">hts_ce</span>
<span class="op">)</span>
<span class="va">hts_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>southern_europe <span class="op">=</span> <span class="va">hts_se</span>,
                 south_eastern_europe <span class="op">=</span> <span class="va">hts_see</span>
<span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hts_np</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">northern_europe</th>
<th align="right">western_europe</th>
<th align="right">central_europe</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">4</td>
<td align="right">17.83245</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">4</td>
<td align="right">12.53093</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">4</td>
<td align="right">19.16617</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">4</td>
<td align="right">12.74882</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">4</td>
<td align="right">14.68639</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">4</td>
<td align="right">13.51903</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ht_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perHts.html">perHts</a></span><span class="op">(</span>north_part <span class="op">=</span> <span class="va">hts_np</span>,
                 south_part <span class="op">=</span> <span class="va">hts_sp</span>
<span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ht_europe</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">north_part</th>
<th align="right">south_part</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">24.83245</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">19.53093</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">26.16617</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">19.74882</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">21.68639</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">20.51903</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Angelika Meraner, Gregor de Cillia, Markus Fröhlich, Alexander Kowarik.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
