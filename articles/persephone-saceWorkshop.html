<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Persephone, Seasonal Adjustment with an Object-oriented Wrapper for RJDemetra • persephone</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Persephone, Seasonal Adjustment with an Object-oriented Wrapper for RJDemetra">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">persephone</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/persephone-hierarchical.html">Hierarchical time series</a>
    </li>
    <li>
      <a href="../articles/persephone-hierarchicalEU.html">Hierarchical time series - construction and weights</a>
    </li>
    <li>
      <a href="../articles/persephone-plotting.html">Plotting with persephone</a>
    </li>
    <li>
      <a href="../articles/persephone-saceWorkshop.html">Persephone, Seasonal Adjustment with an Object-oriented Wrapper for RJDemetra</a>
    </li>
    <li>
      <a href="../articles/persephone-useR.pdf">persephone useR!2019 (PDF)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/statistikat/persephone">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Persephone, Seasonal Adjustment with an Object-oriented Wrapper for RJDemetra</h1>
                        <h4 class="author">Angelika Meraner, Gregor de Cillia, Alexander Kowarik</h4>
            
            <h4 class="date">2019-09-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/statistikat/persephone/blob/master/vignettes/persephone-saceWorkshop.Rmd"><code>vignettes/persephone-saceWorkshop.Rmd</code></a></small>
      <div class="hidden name"><code>persephone-saceWorkshop.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The R-package <span class="citation">(R Core Team <a href="#ref-R">2019</a>)</span> <strong>persephone</strong> <span class="citation">(Meraner, de Cillia, and Kowarik <a href="#ref-persephone">2019</a>)</span> was developed and is still under development to enable easy processing of multiple time series during the production of seasonally adjusted estimates. It will be used as a successor of the R package <strong>x12</strong> <span class="citation">(Kowarik et al. <a href="#ref-x12">2014</a>)</span> which is currently used at Statistics Austria.</p>
<p><strong>RJDemetra</strong> <span class="citation">(Quartier-la-Tente et al. <a href="#ref-RJDemetra">2019</a>)</span>, an R interface to JDemetra+ (<a href="https://github.com/jdemetra" class="uri">https://github.com/jdemetra</a>) is used to perform the seasonal adjustment. Additional, analytic tools such as interactive plots are developed to support the SA expert. This tool makes it easy to construct personalized dashboards containing selected plots and diagnostics and to produce a Eurostat-Quality-Report. The support of hierarchical time series is of importance in the workflow within an official statistics agency and in the future diagnostics for the comparison between direct and indirect seasonal adjustment will be included.</p>
<p>Note on the package name: Obviously, Persephone <span class="citation">(Wikipedia contributors <a href="#ref-wiki:persephone">2019</a>)</span> is an offspring of Demetra (Demeter) and Zeus and also a vegetation goddess. Therefore, it is a natural choice</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>As the package is not yet on the comprehensive R archive network (CRAN <a href="http://cran.r-project.org" class="uri">http://cran.r-project.org</a>), the main R package repository, so it can be installed from GitHub via the following command:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">"statistikat/persephone"</span>)</a></code></pre></div>
<p>Optionally and preferably, it can be installed including vignettes (needs prettydoc<span class="citation">(Qiu <a href="#ref-prettydoc">2019</a>)</span>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">"statistikat/persephone"</span>, <span class="dt">build_vignettes =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>After installation, the package can be loaded into the current R session.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(persephone)</a></code></pre></div>
</div>
<div id="constructing-persephone-objects" class="section level1">
<h1 class="hasAnchor">
<a href="#constructing-persephone-objects" class="anchor"></a>Constructing Persephone Objects</h1>
<p>An object of class <code>persephone</code> can be constructed from only one or multiple time series. These multiple time series can be connected through a certain hierarchy. Depending on whether seasonal adjustment should be performed with X-13-ARIMA-SEATS<span class="citation">(Bureau <a href="#ref-X13">2019</a>)</span> or with TRAMO-SEATS <span class="citation">(Gómez and Maravall <a href="#ref-Tramo">2001</a>)</span>, ‘single’ persephone objects are constructed with the functions <code><a href="../reference/per_x13.html">per_x13()</a></code> or <code><a href="../reference/per_tramo.html">per_tramo()</a></code>. Multiple ‘single’ objects can then be combined with <code><a href="../reference/per_hts.html">per_hts()</a></code> to build a hierarchical persephone object. Batch objects without a hierarchy can be represented as objects with a flat hierachy at the moment, but this will be improved in the future.</p>
<p>Persephone objects call the functions of <strong>RJDemetra</strong> in the background, so for a detailed documentation on the respective X-13 or TRAMO-SEATS methods refer to the R-help of <strong>RJDemetra</strong>.</p>
<div id="persephone-single-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#persephone-single-objects" class="anchor"></a>Persephone Single Objects</h2>
<p>Univariate persephone objects are created with <code><a href="../reference/per_x13.html">per_x13()</a></code> or <code><a href="../reference/per_tramo.html">per_tramo()</a></code> from univariate time series objects such as the <code>AirPassengers</code> data set. A predefined JDemetra+ model specification has to be provided by the user, in this example we use <code>"RSA3"</code> (Log/level detection = automatic, Outliers detection = automatic, Calendar effects = NA, ARIMA = automatic).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(AirPassengers, <span class="dt">package =</span> <span class="st">"datasets"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">obj_x13 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_x13.html">per_x13</a></span>(AirPassengers, <span class="st">"RSA3"</span>)</a></code></pre></div>
<p>Now different methods can be called for the persephone object <code>obj_x13</code>. Most prominently, the <code>run()</code> method performs call to JDemetra+ through RJDemetra to actual run seasonal adjustment method. The <code>output</code> field gives access to the original output object from <strong>RJDemetra</strong>. Before the first run, some methods for the object will not work and some fields will be empty since no results are available yet.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">obj_x13<span class="op">$</span><span class="kw">run</span>()</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">obj_x13<span class="op">$</span>output<span class="op">$</span>regarima</a></code></pre></div>
<pre><code>## y = regression model + arima (0, 1, 1, 0, 1, 1)
## Log-transformation: yes
## Coefficients:
##           Estimate Std. Error
## Theta(1)   -0.4018      0.081
## BTheta(1)  -0.5569      0.078
## 
## 
## Residual standard error: 0.03672 on 131 degrees of freedom
## Log likelihood = 244.7, aic = 987.2 aicc = 987.4, bic(corrected for length) = -6.535</code></pre>
<p>Several plot methods have been implemented and the focus was on using interactive tools. The default S3 generic <code><a href="../reference/plot.html">plot()</a></code> for example shows the time series with the <code>dygraphs</code> package <span class="citation">(Vanderkam et al. <a href="#ref-dygraphs">2018</a>)</span>. The result is a zoomable line representation of the series, see Figure @ref(fig:plotmethod).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/plot.html">plot</a></span>(obj_x13)</a></code></pre></div>
<div class="figure">
<img src="resources/plot.png" alt="\label{fig:plotmethod} Output of the plot() method in the R-Studio viewer pane" width="100%"><p class="caption">
 Output of the plot() method in the R-Studio viewer pane
</p>
</div>
</div>
<div id="adjusting-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#adjusting-parameters" class="anchor"></a>Adjusting Parameters</h2>
<p>All predefined JDemetra+ model specifications can be used in the calls to per_x13 or per_tramo (and also in the hierachical functions), but most of the times it is still necessary to adjust parameters of seasonal adjustment steps more individual. This can of course be done. We will reuse the <code>obj_x13</code> from before, which is generated with the <code>RSA3</code> model specification.</p>
<p>The current parameters are stored in the field <code>params</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">obj_x13<span class="op">$</span>params</a></code></pre></div>
</div>
<div id="persephone-hierarchical-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#persephone-hierarchical-objects" class="anchor"></a>Persephone Hierarchical Objects</h2>
<p>Hierarchical persephone objects are created with <code><a href="../reference/per_hts.html">per_hts()</a></code>. There are two options on how to provide the ‘single’ objects as input. Firstly, directly as arguments, as shown below, this kind of call is mainly applicable for a quite limited number of time series.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">obj_x13_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_x13.html">per_x13</a></span>(AirPassengers, <span class="st">"RSA3"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">obj_x13_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_x13.html">per_x13</a></span>(AirPassengers, <span class="st">"RSA3"</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">obj_x13_hts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_hts.html">per_hts</a></span>(<span class="dt">ts1 =</span> obj_x13_<span class="dv">1</span>, <span class="dt">ts2 =</span> obj_x13_<span class="dv">2</span>)</a></code></pre></div>
<p>Secondly, several ‘single’ objects can be concatenated into a list and provdied to the <code>list</code> argument of the <code><a href="../reference/per_hts.html">per_hts()</a></code> function. We shall call these ‘single’ objects ‘components’ in this multivariate context.</p>
<p>In the more realistic examples below, we use time series of the volume index of production for total industry (except construction) of the EU-28 countries. They are monthly data published by Eurostat covering January 2000 through June 2019. Some series contain missing values. The data sets are downloaded from the Eurostat database <span class="citation">(Eurostat <a href="#ref-STS">2019</a>)</span> and provided with the R package to be used in examples and tests. They can be simply loaded with the <code>data</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(pi_caladj, pi_sa, pi_unadj, weights_pi_ea19, weights_pi_ea19)</a></code></pre></div>
<p>We use the calendar and not seasonally adjusted data <code>pi_caladj</code> for illustrative purposes because it only contains one missing value. <code>weights_pi_ea19</code> and <code>weights_pi_ea19</code> are the data sets containing the weights per country.</p>
<p>We remove the EU-28 and EA-19 (Euro Area) aggregates.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">pi_caladj_orig &lt;-<span class="st"> </span>pi_caladj</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">pi_caladj &lt;-<span class="st"> </span>pi_caladj[ , <span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)]</a></code></pre></div>
<p>We remove the last time point because of the missing value.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">pi_caladj &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/window.html">window</a></span>(pi_caladj, <span class="dt">end =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2019</span>, <span class="dv">5</span>))</a></code></pre></div>
<div id="aggregates-without-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#aggregates-without-weights" class="anchor"></a>Aggregates without Weights</h3>
<p>The next step is to construct a hierarchical persephone object that does not contain weights and computes aggregate series as the sum of the components.</p>
<p>To get started, we generate persephone objects with X13-ARIMA-SEATS as method for all countries’ time series. This is done by simply calling the R builtin function <code>lapply</code> to call the function <code>per_x13</code> on the list of time seriees objects <code>pi_caladj</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">ts_<span class="dv">28</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(pi_caladj, per_x13)</a></code></pre></div>
<p>The list argument can be used to create a hierarchical persephone object based on a list of persephone single objects. Here we aggregate the Euroarea (EA-19) countries and set the method to be used for the direct adjustment of the aggregate series to x13 as well.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">hts_EA19 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_hts.html">per_hts</a></span>(<span class="dt">list =</span> ts_<span class="dv">28</span>[weights_pi_ea19<span class="op">$</span>country], <span class="dt">method =</span> <span class="st">"x13"</span>)</a></code></pre></div>
<p>We now generate our final hierarchical persephone object <code>hts_EU28</code> which consists of the Euroarea countries as a hierarchical object and the 9 countries as single objects.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">non_EA19 &lt;-<span class="st"> </span>weights_pi_eu28<span class="op">$</span>country[<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="op">!</span>weights_pi_eu28<span class="op">$</span>country <span class="op">%in%</span><span class="st"> </span>weights_pi_ea19<span class="op">$</span>country)]</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">hts_EU28 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_hts.html">per_hts</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">EA19=</span>hts_EA19,ts_<span class="dv">28</span>[non_EA19]))</a></code></pre></div>
<p>The structure of this object is represented in the <code>print</code> output. The “blank” component is the overall total.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">hts_EU28</a></code></pre></div>
<pre><code>##  component run   class                 
##            FALSE hierarchicalTimeSeries
##  EA19      FALSE hierarchicalTimeSeries
##  EA19/BE   FALSE x13Single             
##  EA19/DE   FALSE x13Single             
##  EA19/EE   FALSE x13Single             
##  EA19/IE   FALSE x13Single             
##  EA19/EL   FALSE x13Single             
##  EA19/ES   FALSE x13Single             
##  EA19/FR   FALSE x13Single             
##  EA19/IT   FALSE x13Single             
##  EA19/CY   FALSE x13Single             
##  EA19/LT   FALSE x13Single             
##  EA19/LV   FALSE x13Single             
##  EA19/LU   FALSE x13Single             
##  EA19/MT   FALSE x13Single             
##  EA19/NL   FALSE x13Single             
##  EA19/AT   FALSE x13Single             
##  EA19/PT   FALSE x13Single             
##  EA19/SI   FALSE x13Single             
##  EA19/SK   FALSE x13Single             
##  EA19/FI   FALSE x13Single             
##  BG        FALSE x13Single             
##  CZ        FALSE x13Single             
##  DK        FALSE x13Single             
##  HR        FALSE x13Single             
##  HU        FALSE x13Single             
##  PL        FALSE x13Single             
##  RO        FALSE x13Single             
##  SE        FALSE x13Single             
##  UK        FALSE x13Single</code></pre>
<p>We can initiate a first run with</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">hts_EU28<span class="op">$</span><span class="kw">run</span>()</a></code></pre></div>
<p>and have a look at the summary (not yet implemented, but coming in an update of this vignette soon).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># summary(hts_EU28)</span></a></code></pre></div>
<p>The only plot function implemented for hierarchical persephone objects at the moment is a general comparison line chart called through the S3 generic <code><a href="../reference/plot.html">plot()</a></code>, see Figure @ref(fig:plotmethodhts).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="../reference/plot.html">plot</a></span>(hts_EU28)</a></code></pre></div>
<div class="figure">
<img src="resources/plot_hts.png" alt="\label{fig:plotmethodhts} Output of the plot() method for a hierarchical persephone object in the R-Studio viewer pane" width="100%"><p class="caption">
 Output of the plot() method for a hierarchical persephone object in the R-Studio viewer pane
</p>
</div>
<p>We can however access the components of a hierarchical persephone object and use the methods developed for univariate analysis, e.g. we can plot the auto-correlations of the residuals for the Belgian time series, see Figure @ref(fig:acfresbg), where the component <code>"BE"</code> can either be addressed by <code>hts_EU28$get_component("EA19/BE")</code> or by <code>hts_EU28$components$EA19$components$BE</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="../reference/plotResiduals.html">plotResiduals</a></span>(hts_EU28<span class="op">$</span><span class="kw">get_component</span>(<span class="st">"EA19/BE"</span>), <span class="dt">which =</span> <span class="st">"acf"</span>, <span class="dt">interactive =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div class="figure">
<img src="persephone-saceWorkshop_files/figure-html/unnamed-chunk-19-1.png" alt="\label{fig:acfresbg} Output of the plotResiduals() method for the Belgian time series" width="100%"><p class="caption">
 Output of the plotResiduals() method for the Belgian time series
</p>
</div>
<p>Also the results of lower level aggregate series are accessed via the components. The EA19 aggregate for example would be plotted by using the following command:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="../reference/plot.html">plot</a></span>(hts_EU28<span class="op">$</span><span class="kw">get_component</span>(<span class="st">"EA19"</span>))</a></code></pre></div>
</div>
<div id="weighted-aggregates" class="section level3">
<h3 class="hasAnchor">
<a href="#weighted-aggregates" class="anchor"></a>Weighted Aggregates</h3>
<p>If the time series are indices, we are not really interested in the sum of the components but in the weighted sum. We can use either time-invariant or time-variant weights.</p>
<div id="time-invariant-weights" class="section level4">
<h4 class="hasAnchor">
<a href="#time-invariant-weights" class="anchor"></a>Time-invariant weights</h4>
<p>The weights parameter is set as a numeric vector with length equal to the number of components. The hierarchical persephone object is constructed in the same way as in the previous section but with weights, one for each component. Internally, an <code>mts</code> object is then created with constant weights for all time points.</p>
<p>We include the weights from the data set <code>weights_pi_eu28</code> in the hierarchical persephone object:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># First we split the weights vector in two (EA19 and nonEA19)</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">w_EA19 &lt;-<span class="st"> </span>weights_pi_eu28<span class="op">$</span>weight[</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">   <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(weights_pi_eu28<span class="op">$</span>country <span class="op">%in%</span><span class="st"> </span>weights_pi_ea19<span class="op">$</span>country)]</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">w_non_EA19 &lt;-<span class="st"> </span>weights_pi_eu28<span class="op">$</span>weight[</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">   <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="op">!</span>weights_pi_eu28<span class="op">$</span>country <span class="op">%in%</span><span class="st"> </span>weights_pi_ea19<span class="op">$</span>country)]</a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="co"># The first per_hts call is for the EA19 countries</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7">hts_EA19 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_hts.html">per_hts</a></span>(<span class="dt">list =</span> ts_<span class="dv">28</span>[weights_pi_ea19<span class="op">$</span>country], <span class="dt">method =</span> <span class="st">"x13"</span>, <span class="dt">weights =</span> w_EA19)</a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="co"># We then combine the hts_EA19 object with the non_EA19 countries.</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9">hts_EU28 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_hts.html">per_hts</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">EA19 =</span> hts_EA19),ts_<span class="dv">28</span>[non_EA19]), <span class="dt">weights =</span> w_non_EA19)</a></code></pre></div>
<p>Please note that in the generation step of <code>hts_EU28</code> the weights in <code>w_non_EA19</code> are only used for the single persephone objects in the <code>list</code> input and not for the hierachical persephone object <code>hts_EA19</code>.</p>
<p>To perform a run on all components, we just call the <code>run</code> method on the <code>hts_EU28</code> object.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">hts_EU28<span class="op">$</span><span class="kw">run</span>()</a></code></pre></div>
<p>We can have a look at the weights of an object by accessing the <code>weights</code> field.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(hts_EU28<span class="op">$</span>weights)</a></code></pre></div>
<pre><code>##        EA19    BG    CZ    DK    HR    HU    PL    RO    SE     UK
## [1,] 73.751 0.394 1.977 1.879 0.324 1.126 3.835 0.993 2.926 12.795
## [2,] 73.751 0.394 1.977 1.879 0.324 1.126 3.835 0.993 2.926 12.795
## [3,] 73.751 0.394 1.977 1.879 0.324 1.126 3.835 0.993 2.926 12.795
## [4,] 73.751 0.394 1.977 1.879 0.324 1.126 3.835 0.993 2.926 12.795
## [5,] 73.751 0.394 1.977 1.879 0.324 1.126 3.835 0.993 2.926 12.795
## [6,] 73.751 0.394 1.977 1.879 0.324 1.126 3.835 0.993 2.926 12.795</code></pre>
<p>We can also show that the EU-28 aggregate series generated by persephone matches the data published by Eurostat apart from certain rounding differences:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># Eurostat EU28-Series</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/stats/window.html">window</a></span>(pi_caladj_orig[, <span class="st">"EU28"</span>], <span class="dt">start =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2019</span>,<span class="dv">1</span>))</a></code></pre></div>
<pre><code>##        Jan   Feb   Mar   Apr   May   Jun
## 2019 103.4 103.4 114.1 104.6 106.7 106.8</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co"># Persephone EU28-Series</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/stats/window.html">window</a></span>(hts_EU28<span class="op">$</span>ts, <span class="dt">start =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2019</span>,<span class="dv">1</span>))</a></code></pre></div>
<pre><code>##           Jan      Feb      Mar      Apr      May
## 2019 103.3384 103.3205 113.9927 104.4974 106.5973</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># Maximum absolute difference</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(pi_caladj_orig[, <span class="st">"EU28"</span>] <span class="op">-</span><span class="st"> </span>hts_EU28<span class="op">$</span>ts))</a></code></pre></div>
<pre><code>## [1] 0.112941</code></pre>
</div>
<div id="time-variant-weights" class="section level4">
<h4 class="hasAnchor">
<a href="#time-variant-weights" class="anchor"></a>Time-variant weights</h4>
<p>We do not have a real-life example for time-variant weights which is why we generate artificial weights for our example.</p>
<p>This R code can be ignored as it is used to make the weights randomly time-variant. The result is a list of time series, one for each country.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">weights_pi_eu28_time &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="st">"c"</span>, <span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(weights_pi_eu28,<span class="dv">1</span>, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">   l &lt;-<span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Lognormal.html">rlnorm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(pi_caladj))<span class="op">/</span><span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(x[<span class="dv">2</span>]),<span class="dt">start =</span> <span class="kw"><a href="https://rdrr.io/r/stats/start.html">start</a></span>(pi_caladj),</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">                 <span class="dt">end =</span> <span class="kw"><a href="https://rdrr.io/r/stats/start.html">end</a></span>(pi_caladj),</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">                 <span class="dt">frequency =</span> <span class="kw"><a href="https://rdrr.io/r/stats/time.html">frequency</a></span>(pi_caladj)))</a>
<a class="sourceLine" id="cb33-5" data-line-number="5">   <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(l) &lt;-<span class="st"> </span>x[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">   <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(l)</a>
<a class="sourceLine" id="cb33-7" data-line-number="7">   }))</a></code></pre></div>
<p>We can then create a hierarchical persephone object as in the previous section</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">w_EA19 &lt;-<span class="st"> </span>weights_pi_eu28_time[<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(weights_pi_eu28<span class="op">$</span>country <span class="op">%in%</span><span class="st"> </span>weights_pi_ea19<span class="op">$</span>country)]</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">w_non_EA19 &lt;-<span class="st"> </span>weights_pi_eu28_time[<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="op">!</span>weights_pi_eu28<span class="op">$</span>country <span class="op">%in%</span><span class="st"> </span>weights_pi_ea19<span class="op">$</span>country)]</a>
<a class="sourceLine" id="cb34-3" data-line-number="3"></a>
<a class="sourceLine" id="cb34-4" data-line-number="4">hts_EA19 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_hts.html">per_hts</a></span>(<span class="dt">list =</span> ts_<span class="dv">28</span>[weights_pi_ea19<span class="op">$</span>country], <span class="dt">method =</span> <span class="st">"x13"</span>, <span class="dt">weights=</span>w_EA19)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">hts_EU28 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/per_hts.html">per_hts</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">EA19 =</span> hts_EA19),ts_<span class="dv">28</span>[non_EA19]), <span class="dt">weights =</span> w_non_EA19)</a></code></pre></div>
<p>and perform a run.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">hts_EU28<span class="op">$</span><span class="kw">run</span>()</a></code></pre></div>
</div>
</div>
</div>
</div>
<div id="eurostat-report" class="section level1">
<h1 class="hasAnchor">
<a href="#eurostat-report" class="anchor"></a>Eurostat Report</h1>
<p>The function <code><a href="../reference/generate_qr_table.html">generate_qr_table()</a></code> renders a Eurostat quality report in the form of a <code>data.frame</code> which can then be exported by the user.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">eurostatQR &lt;-<span class="st"> </span><span class="kw"><a href="../reference/generate_qr_table.html">generate_qr_table</a></span>(hts_EU28)</a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(eurostatQR)</a></code></pre></div>
<pre><code>##   component Method Period Nobs  Start    End Log.Transformation
## 1               TS     12  233 1-2000 5-2019               TRUE
## 2      EA19    x13     12  233 1-2000 5-2019              FALSE
## 3   EA19/BE    x13     12  233 1-2000 5-2019              FALSE
## 4   EA19/DE    x13     12  233 1-2000 5-2019              FALSE
## 5   EA19/EE    x13     12  233 1-2000 5-2019               TRUE
## 6   EA19/IE    x13     12  233 1-2000 5-2019               TRUE
##      ARIMA.Model LeapYear MovingHoliday NbTD Noutliers     Outlier1
## 1 (0 1 1)(0 1 1)    FALSE         FALSE    6         3 LS (11-2008)
## 2 (0 1 1)(0 1 1)     TRUE         FALSE    7         2 LS (11-2008)
## 3 (0 1 1)(0 1 1)     TRUE         FALSE    7         2 LS (11-2008)
## 4 (1 1 2)(0 1 1)     TRUE         FALSE    7         3  LS (1-2009)
## 5 (3 1 1)(0 1 1)    FALSE         FALSE    0         2 LS (10-2008)
## 6 (1 1 1)(0 1 1)    FALSE          TRUE    0         4  LS (2-2015)
##       Outlier2    Outlier3 CombinedTest_SI Residual.Seasonality
## 1 LS (12-2008) LS (1-2009)         Present                   No
## 2 TC (11-2008)        &lt;NA&gt;         Present                   No
## 3  AO (5-2009)        &lt;NA&gt;         Present                   No
## 4 LS (11-2008) TC (3-2009)         Present                   No
## 5 TC (10-2008)        &lt;NA&gt;         Present                   No
## 6  LS (2-2014) AO (3-2018)            None                   No
##   Residual.TD.Effect Q.Stat Final.Henderson.Filter
## 1                 No     NA                   &lt;NA&gt;
## 2                 No   0.19                    H13
## 3                 No   0.35                    H13
## 4                 No   0.23                    H13
## 5                Yes   0.26                    H13
## 6                 No   1.76                    H23
##   Stage.2.Henderson.Filter Seasonal.Filter Max.Adj
## 1                     &lt;NA&gt;            &lt;NA&gt;     20%
## 2                      H13             3x5     27%
## 3                      H13             3x5     14%
## 4                      H13             3x5      9%
## 5                      H13             3x5     12%
## 6                      H23             3x5     23%</code></pre>
<p>The Eurostat QR corresponds to the JD+ plugin version 1, see , with the exception that no overall index of quality is included since it is not available to us from <strong>RJDemetra</strong> at the moment and is not trivial to recalculate it.</p>
<div id="refs" class="references">
<div id="ref-X13">
<p>Bureau, US Census. 2019. “X-13 Arima Seats Seasonal Adjustment Program.” <a href="https://www.census.gov/srd/www/x13as/" class="uri">https://www.census.gov/srd/www/x13as/</a>.</p>
</div>
<div id="ref-STS">
<p>Eurostat. 2019. “Database - Short-Term Business Statistics.” <a href="https://ec.europa.eu/eurostat/web/short-term-business-statistics/data/database" class="uri">https://ec.europa.eu/eurostat/web/short-term-business-statistics/data/database</a>.</p>
</div>
<div id="ref-Tramo">
<p>Gómez, Víctor, and Agustín Maravall. 2001. “Seasonal Adjustment and Signal Extraction in Economic Time Series.” <em>A Course in Time Series Analysis</em>. Citeseer, 202–47.</p>
</div>
<div id="ref-x12">
<p>Kowarik, Alexander, Angelika Meraner, Matthias Templ, and Daniel Schopfhauser. 2014. “Seasonal Adjustment with the R Packages x12 and x12GUI.” <em>Journal of Statistical Software</em> 62 (2): 1–21. <a href="http://www.jstatsoft.org/v62/i02/" class="uri">http://www.jstatsoft.org/v62/i02/</a>.</p>
</div>
<div id="ref-persephone">
<p>Meraner, Angelika, Gregor de Cillia, and Alexander Kowarik. 2019. <em>Persephone: Object-Oriented Wrappers for Rjdemetra</em>. <a href="https://github.com/statistikat/persephone" class="uri">https://github.com/statistikat/persephone</a>.</p>
</div>
<div id="ref-prettydoc">
<p>Qiu, Yixuan. 2019. <em>Prettydoc: Creating Pretty Documents from R Markdown</em>. <a href="https://CRAN.R-project.org/package=prettydoc" class="uri">https://CRAN.R-project.org/package=prettydoc</a>.</p>
</div>
<div id="ref-RJDemetra">
<p>Quartier-la-Tente, Alain, Anna Michalek, Jean Palate, and Raf Baeyens. 2019. <em>RJDemetra: Interface to ’Jdemetra+’ Seasonal Adjustment Software</em>. <a href="https://CRAN.R-project.org/package=RJDemetra" class="uri">https://CRAN.R-project.org/package=RJDemetra</a>.</p>
</div>
<div id="ref-R">
<p>R Core Team. 2019. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-dygraphs">
<p>Vanderkam, Dan, JJ Allaire, Jonathan Owen, Daniel Gromer, and Benoit Thieurmel. 2018. <em>Dygraphs: Interface to ’Dygraphs’ Interactive Time Series Charting Library</em>. <a href="https://CRAN.R-project.org/package=dygraphs" class="uri">https://CRAN.R-project.org/package=dygraphs</a>.</p>
</div>
<div id="ref-wiki:persephone">
<p>Wikipedia contributors. 2019. “Persephone — Wikipedia, the Free Encyclopedia.” <a href="https://en.wikipedia.org/wiki/Persephone" class="uri">https://en.wikipedia.org/wiki/Persephone</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#installation">Installation</a></li>
      <li>
<a href="#constructing-persephone-objects">Constructing Persephone Objects</a><ul class="nav nav-pills nav-stacked">
<li><a href="#persephone-single-objects">Persephone Single Objects</a></li>
      <li><a href="#adjusting-parameters">Adjusting Parameters</a></li>
      <li><a href="#persephone-hierarchical-objects">Persephone Hierarchical Objects</a></li>
      </ul>
</li>
      <li><a href="#eurostat-report">Eurostat Report</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Angelika Meraner, Gregor de Cillia, Alexander Kowarik.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
